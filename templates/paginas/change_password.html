{% load i18n static %} {# Carrega as tags necessárias #}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% translate 'Atualizar Senha' %}</title> {# Título da aba #}
    {{ form.media }} {# Inclui JS/CSS do formulário, se houver #}
    <style>
      /* --- ESTILOS INDEPENDENTES (COPIADO E ADAPTADO) --- */
      html, body {
        height: 100%; margin: 0; padding: 0;
        font-family: sans-serif; background-color: #ffffff;
      }
      body {
        display: flex; justify-content: center; align-items: center;
      }
      .container { width: 100%; max-width: 450px; }
      .auth-box {
          background-color: #f8f8f8; padding: 2.5rem; border-radius: 8px;
          box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 1rem; /* Diminuído espaço antes do Sair */
      }
      /* Branding */
      .branding {
          display: flex; flex-direction: column; align-items: center;
          margin-bottom: 1.5rem; /* Ajustado espaço */
          /* margin-top: -2rem; */ /* Mantém ajuste de altura se necessário */
      }
      .branding img { width: 200px; height: auto; margin-bottom: 15px; }
      /* --- NOVO: Estilo para Saudação --- */
      .branding .user-greeting {
          color: #333; font-size: 1.1em; font-weight: normal; margin: 0 0 10px 0;
      }
      /* --- FIM NOVO --- */
      .branding .auth-title { display: none; } /* Oculta título genérico se não precisar */

      /* Mensagem e Texto Ajuda */
      .message p { color: #555; margin-bottom: 1.5rem; line-height: 1.6; text-align: left; font-size: 0.9em; }
      .helptext { font-size: 0.8em; color: #777; margin-top: 5px; margin-bottom: 10px; display: block;}
      /* Form */
      .form-row { margin-bottom: 1rem; } /* Menos espaço entre campos */
      .form-row label {
          font-size: 1em; text-align: left; display: block; width: 100%;
          margin-bottom: 5px; color: #555; font-weight: bold;
      }
      .form-row input[type="password"] {
          width: 100%; padding: 12px; border: 1px solid #ccc;
          border-radius: 4px; box-sizing: border-box;
      }
      ul.errorlist { list-style: none; padding: 0; color: #ba2121; font-size: 0.9em; margin-top: 5px; margin-bottom: 1rem; text-align: left; }
      .errornote { color: #ba2121; background-color: #ffdddd; border: 1px solid #ba2121; border-radius: 4px; padding: 10px; margin-bottom: 1rem; text-align: center;}
      /* Botão Salvar */
      button[type="submit"] {
          width: 100%; padding: 12px; font-size: 1.1em; margin-top: 1rem; background-color: #0056b3; border: none; border-radius: 4px; color: white; cursor: pointer; font-weight: bold;
      }
      button[type="submit"]:hover { background-color: #004494; }
      /* Link/Botão Sair */
      .logout-link { text-align: center; margin-top: 1rem; }
      .link-button { /* Estilo para o botão Sair parecer link */
          background: none; border: none; color: #777;
          text-decoration: none; cursor: pointer; padding: 0;
          font-size: 0.9em; font-family: sans-serif;
      }
      .link-button:hover { text-decoration: underline; color: #555; }
    </style>
</head>
<body class="login">

<div class="container">
  <form method="POST" class="auth-box">{% csrf_token %}

    <div class="branding">
        <img src="{% static 'logo.png' %}" alt="Logotipo Lider Drive">
        {# --- MOSTRA O NOME DO USUÁRIO LOGADO --- #}
        <p class="user-greeting">Olá, <strong>{{ user.username }}</strong>!</p>
        {# Se quiser um título aqui, pode adicionar #}
        {# <p class="auth-title">Atualize sua Senha</p> #}
    </div>

    <div class="message">
      <p>Este é seu primeiro acesso ou sua senha foi redefinida. Para continuar, defina uma nova senha segura.</p>
    </div>

    {% if form.non_field_errors %}
        {% for error in form.non_field_errors %}
            <p class="errornote">{{ error }}</p>
        {% endfor %}
    {% endif %}

    <div class="form-row">
        {{ form.old_password.errors }}
        <label for="{{ form.old_password.id_for_label }}">{{ form.old_password.label }}:</label>
        {{ form.old_password }}
    </div>
    <div class="form-row">
        {{ form.new_password1.errors }}
        <label for="{{ form.new_password1.id_for_label }}">{{ form.new_password1.label }}:</label>
        {{ form.new_password1 }}
        {% if form.new_password1.help_text %}
        <div class="helptext">{{ form.new_password1.help_text|safe }}</div>
        {% endif %}
    </div>
    <div class="form-row">
        {{ form.new_password2.errors }}
        <label for="{{ form.new_password2.id_for_label }}">{{ form.new_password2.label }}:</label>
        {{ form.new_password2 }}
        {% if form.new_password2.help_text %}
        <div class="helptext">{{ form.new_password2.help_text|safe }}</div>
        {% endif %}
    </div>

    <button type="submit">Salvar Nova Senha</button>
  </form>

  {# --- FORMULÁRIO DE LOGOUT (USA POST) --- #}
  <div class="logout-link">
     <form action="{% url 'logout' %}" method="post" style="display: inline;">
       {% csrf_token %}
       <button type="submit" class="link-button">Sair</button>
     </form>
  </div>

</div>

</body>
</html>